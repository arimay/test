require 'spec_helper'

describe "TimeCursor::Matcher#match" do

  [
    [{at: "2015-02-26 01:23:45.678"},           "2015-02-26 01:23:45"                         ],
    [{cron: "* * * * *"},                       "2015-02-26 01:24:00"                         ],
    [{sec: '10-59/20'},                         "2015-02-26 01:24:10"                         ],

    [{at: '2015-02-26 01:00'},                  "2015-02-26 01:00:00"                         ],
    [{year: 2015, month: 2, day: 26, hour: 1},  "2015-02-26 01:00:00"                         ],
    [{cron: '0  9,17  *  *  mon-fri'},          "2015-02-26 09:00:00"                         ],
    [{wday: 'mon-fri', hour: [9,17]},           "2015-02-26 09:00:00"                         ],
    [{cron: '0  12  1-7  *  sun'},              "2015-03-01 12:00:00"                         ],
    [{day: 1..7, wday: 'sun', hour: '12'},      "2015-03-01 12:00:00"                         ],
    [{sec: '*/10'},                             "2015-02-26 01:24:00"                         ],
  ].each do |opts, target|
    it "" do
      expect( TimeCursor.new( **opts ).match( target ).class ).to  eq( Time )
    end
  end

  [
    [{at: "2015-02-26 01:23:45.678"},           "2015-02-26 01:23:01"                         ],
    [{cron: "* * * * *"},                       "2015-02-26 01:24:01"                         ],
    [{sec: '10-59/20'},                         "2015-02-26 01:24:01"                         ],

    [{at: '2015-02-26 01:00'},                  "2015-02-26 01:00:01"                         ],
    [{year: 2015, month: 2, day: 26, hour: 1},  "2015-02-26 01:00:01"                         ],
    [{cron: '0  9,17  *  *  mon-fri'},          "2015-02-26 09:01:00"                         ],
    [{wday: 'mon-fri', hour: [9,17]},           "2015-02-26 09:01:00"                         ],
    [{cron: '0  12  1-7  *  sun'},              "2015-03-01 12:01:00"                         ],
    [{day: 1..7, wday: 'sun', hour: '12'},      "2015-03-01 12:01:00"                         ],
    [{sec: '*/10'},                             "2015-02-26 01:24:01"                         ],
  ].each do |opts, target|
    it "" do
      expect( TimeCursor.new( **opts ).match( target ).class ).to  eq( NilClass )
    end
  end

end

